# Makefile



- 编译规则：

  ```
  目标：依赖
  	命令
  ```

- 只应该有一个最终目标(第一个目标)

- 以 Unix 标准的 shell 执行命令

- 转义字符：`\`

- 标签，Label；例如 `.PHNOY`

- 多目标：多个目标的生成规则的执行命令是同一个

- `$@`：表示目前规则中所有目标的集合。就像一个数组，依次取出其中的目标，并执行

- `$<`：表示目前所有的依赖

- `-M`：自动寻找源文件中包含的头文件，并生成一个依赖关系

- make 会把其要执行的命令行 <font color=red>在命令执行前</font> 输出到屏幕上。当使用`@`字符在命令行前，则不显示

- make 参数`-s`或`--slient`则是全面禁止命令的显示

- 如果要让上一条命令的结果应用在下一条命令时，应该使用分号分隔这两条命令

  ```makefile
  exec:
  	cd /home/hchen
  	pwd
  # 输出结果: 当前 Makefile 所在的路径
  
  exec:
  	cd /home/hchen; pwd
  # 输出结果： /home/hchen
  ```

  

- make 在一些大的工程中，会把不同模块或是不同功能的源文件放在不同的目录中，我们可以再每个目录中都书写一个该目录的 Makefile，这有利于让我们的 Makefile 变得更加简洁

- 主 Makefile 中的变量默认不会传递给 子Makefile，使用 `export` 传递变量到下级或使用`-e`参数

  - 如果要传递所有的变量，使用一个 `export` 即可

  - 默认 `SHELL、MAKEFLAGS` 两个变量不论是否 `export` 都会传递到下层 Makefile

  - `-w`用于打印进入目前的工作目录及退出当前的工作目录，使用`-C`参数指定 make 下层`Makefile` 时，`-w` 会自动打开



- 变量在声明时需要给予初值，在使用时，需要在变量名前加上`$`符号



- 指定 makefile ：使用 `-f/--file` 参数指定一个特殊名字的 Makefile
- 指定读取 makefile 的目录：`-C <dir>` / `--directory=<dir>` 



- `$@`：表示规则中的目标文件集。所有的目标
- `$%`：仅当目标是函数库文件中，表示规则中的目标成员名。
- `$<`：依赖目标中的第一个目标名字。如果依赖目标是以模式`%`定义的，那么`$<`将是符合模式的一系列的文件集。注意，其是一个一个取出来的。
- `$?`：所有比目标新的依赖目标的集合。  所有比目标新的依赖
- `$^`：所有的依赖目标的集合。  所有的依赖，如果有重复，会自动去重
- `$+`：所有依赖的集合。 所有的依赖，不去重