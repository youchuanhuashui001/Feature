# 	备忘录



- 10-20
  - [ ] XT25F32F 测试 flash comtest、添加四倍速、料号
  
    - [ ] 掉电测试，300次中经常会出现1次或两次的失败 
  
  - [ ] XT25F64F 测试掉电、联系厂家与 XT25F64B 做区分、添加四倍速、料号
  
  - [x] 2G 的 SPI NAND ecc测试出错
  
    - [x] 1G 的 已支持的 ecc 测试也会出错
  
      ```
      1. 随机选取一个 block，擦除数据
      2. 开启 ecc，按 page 读取这个 block 的所有数据
      3. 判断是否为全 F
      4. 关闭 ecc，对擦除后的 block 按 page 写入数据(每个page 伪造 1bit 0数据)
      5. 开启 ecc，读取该 block 每个 page 的数据
      6. 在读取的过程中，ecc 状态位 为 0000，即无数据翻转
      7. 读取的数据为伪造后的数据，即未纠正回来
      ```
  
      



- 10-31

  - [ ] XTX 2G 的 SPI NAND 基本测试通过，跑一下 comtest ，要在 cygnus 上测一下四倍速
    - [ ] comtest
    - [ ] 掉电
  - [x] XTX 4G 的 SPI NAND 还起不来，要确认一下原因
    - [ ] comtest
    - [ ] 掉电
  - [ ] XTXF32F 的问题，要确认原因
  - [x] XT25F64F 要测掉电，联系厂家与 XT25F64B 做区分、四倍速和料号
    - [ ] 掉电
    - [ ] 料号
  - [ ] XT25F128F 直接替换掉 XT25F128B，四倍速和料号 + 优先添加
    - [ ] 读写擦测试中
    - [x] otp 相关要修改

  - [x] 签名加密工具：

    - [x] 拷贝 input 的上一级目录到 output，再进行签名

    - [x] output 目录存在的话就直接使用，不存在的话就拷贝一份
    - [ ] help.txt 写在运行的 help 信息中

  - [ ] 新增 cygnus 的 SPI NAND 4K page   #327960





- stage1 代码是存放了5份的，如果其中一份坏了，是否仍能启动
  - 用二进制编辑一下前面的一份 stage1

- 编译成 O0 后太大了，可以对想要 调试的 函数 使用 `__attribute__(( optimize( "-O0" )))` 指定特定函数不优化
- 不能修改 copy_stage1 的 size ，因为 rom 代码固定只拷贝 8k 的代码





1. 在 .boot 里面测试 flash comtest，看 flash 的读写擦是否正常
2. 使用逻辑分析仪看是不是读了 55aa，8k 的 stage1 数据
3. 看制作出来的 .bin 中，应该有5份 stage1 ，每份都是 16k大小，因为有 2k 数据 + 2k 保留





掉电脚本：

- 预留boot地址，以预留的地址的下一个block为起始位置，全部写入随机数据
- 读取写入的随机数据，判断是否与写入的相同
- 在预留的地址到 Flash 的最后一个block中间随机选取30个block进行写入和擦除操作
- 在对这30个block进行写入和擦除操作过程中延时一定时间断电，目的是让在写 一个block 的时候出现掉电
- 重新上电，从预留的起始地址读取数据，判断是否为写入的随机数据
- 如果出现不相同的，就对这个block进行擦除、写入、再读取
- 如果出现两个block的数据都不相同，就说明这个在 block 掉电的时候影响到了其它的 block















