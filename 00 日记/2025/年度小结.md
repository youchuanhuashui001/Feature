
# AI 模板
```
请你分析以下日记中的内容，然后将每个文件的内容按照标题统一到一起，只需要日记中的今日工作安排、工作进展、以及技术总结，其余的不要。最后，请你再额外帮我生成本周的工作小结。

详细解释：

"请你分析以下日记中的内容": 这一部分是告诉我要处理的对象是日记内容。
"然后将每个文件的内容按照标题统一到一起": 明确要求我将不同日记文件中相同标题的内容合并。
"只需要日记中的今日工作安排、工作进展、以及技术总结，其余的不要": 明确指定需要提取的具体内容，避免包含其他不必要的信息。
"最后，请你再额外帮我生成本周的工作小结": 要求我根据提取的信息，生成总结性的工作小结(请按照不同的工作内容进行区分)。

[[2025-02-24-星期一]] [[2025-02-25-星期二]] [[2025-02-26-星期三]] [[2025-02-27-星期四]] [[2025-02-28-星期五]]
```


# 第 9 周

## 内容合并

### 今日工作安排

*   **2025-02-24 星期一**
    *   [[WS2811]] 代码确认，测试目前可用的功能，找芯片确认测试标准
    *   [[Uboot 支持 SPI Nor Flash 驱动]] 搭建环境
*   **2025-02-25 星期二**
    *   [[Sagitta NRE FPGA IODMA 模块验证]]：整理好代码，现在只能用 32MHz 的时钟测试，48MHz 的时钟到时候出了 bit 可以直接切过去测试一把就好了
*   **2025-02-26 星期三**
    *   [[Sagitta NRE FPGA IODMA 模块验证]]：新 bit 完整测试
    *   [[Uboot 支持 SPI Nor Flash 驱动]]：了解启动流程以及 uboot
*   **2025-02-27 星期四**
    *   [[Sagitta NRE FPGA IODMA 模块验证]]：
        *   26 号的 bit 前面会发一些乱数据，分析具体原因
        *   软件规避串色：发 GRB 之前先发 Reset，确保 GRB 是干净的
        *   16 线输出也没看，因为有乱数据，没必要看
    *   Virgo rom、stage1 flash 驱动整理
    *   Robots：烧写
*   **2025-02-28 星期五**
    *   [[Sagitta NRE FPGA IODMA 模块验证]]：前面会有乱数据，芯片在仿真
    *   确认 GT25Q64A 支持的分支，spi 采样点在哪里，上升沿还是下降沿

### 工作进展

*   **2025-02-24 星期一**
    *   WS2812 代码通了，但是当前的模式不太满足 WS2812 的手册时序要求，思考一下
    *   可以切成 pll 48MHz，时序可以满足手册要求，但是当前 bit 切成 pll 还是 32MHz，需要等新的 bit
    *   delay 寄存器表示的是延时时间，单位是时钟频率的一个周期，例如要发 1，第一个周期发了 1，delay 配成 1，那么第二个周期也会发 1；如果 delay 是 2，那么第三个周期也会发 1
    *   也可以理解成波形的持续时间是寄存器值+1
*   **2025-02-25 星期二**
    *   Sagitta iodma 验证：
        *   ws2812：没有出 48MHz 的 bit，把代码都迁到 `drivers/drv-sagitta/test/src` 目录下，用新的 fmc 子板测试通过
        *   iodma：把代码迁到 `drivers/drv-sagitta/test/src` 目录下，用新的 fmc 子板测试
        *   测试代码都准备好了
            *   测试 iodma：`driver_test iodma comtest`
                *   打开 Debug 信息
                *   修改 `Single_transfer_size = 0x100`
            *   测试 ws2812：`driver_test ws2812 xxx`
*   **2025-02-26 星期三**
    *   Sagitta IODMA 验证：
        *   验证 16 线输出功能是否正常
            *   正常
        *   排查并解决 IODMA 传输 0x300 word 数据时中断无法触发的问题
            *   正常
        *   测试 48MHz 时钟频率下，能否避免 WS2812 出现串色现象
            *   串色更严重了，之前是 63ns 一个周期的时候，5 个周期高电平，5 个周期低电平时间效果还挺好的
            *   现在是 64.9ns 一个周期
    *   Uboot 支持 SPI Nor Flash：
        *   了解启动流程：
        *   Uboot：
            *   启用 spl：
                *   `rom --> spl --> uboot prpper (完整 uboot) --> linux kernel`
                *   编译生成 `spl/u-boot-spl.bin` 以及 `u-boot.bin（完整 uboot）`
*   **2025-02-27 星期四**
    *   Virgo rom、stage1 flash 驱动整理：
        *   rom：
            *   spi 模式是 TX_AND_RX(读数据的时候需要写数据)，8bit 位宽
            *   flash 指令是 0x03 + 3 字节地址，然后开始读数据
        *   stage1：
            *   spi 模式是 TX_AND_RX，8bit 位宽
            *   flash 指令是 0x0b + 3 字节地址 + dummy
        *   stage1 为 bbt 用的时候会使能 4 线模式，但是 Vega 不支持 bbt 四倍速，后面 virgo 为了支持 bbt 四倍速会再提供两个参数：是否使能四倍速，使能四倍速的方法
        *   rom 中 spi 的频率是 8 分频，一直没用上 sample_delay，是不是可以把频率提高点，然后指令也换成 0x0b?
    *   Robots：
        *   烧写：4 线模式读写，并且开了 DMA
        *   rom：
            *   spi：ro 模式，8bit 位宽
            *   flash：双线模式，0x3b
        *   Stage1：
            *   spi：ro 模式，8bit 位宽
            *   flash：4 线模式，指令为 0x6b
        *   rom 中 spi 的频率是 8 分频，一直没用上 sample_delay，是不是可以把频率提高点，然后指令也换成 0x0b? 或者用 0x3b?
        *   stage1 提供给 bbt 用的时候会使能 4 倍速加快速度，但是 Vega 不支持 bbt 四倍速，后面 virgo 为了支持 bbt 四倍速会再提供两个参数：是否使能四倍速，使能四倍速的方法
*   **2025-02-28 星期五**
    *   确认 GT25Q64A 支持的分支，spi 采样点在哪里，上升沿还是下降沿
        *   ECOSV1.8.3/1.9.6-4-lts, gxloader + ecos
            *   用的是 gx spi，CPOL、CPHA 配的都是 0，在第一个上升沿采样
        *   SDKV2.4.1 /1.9.8-8.1, gxloader + ecos
            *   也是用的 gx spi，CPOL、CPHA 配的都是 0，在第一个上升沿采样

### 技术总结

*   **2025-02-24 星期一**
    *   WS2812 Delay 寄存器用法：
        *   delay 寄存器表示的是延时时间，单位是时钟频率的一个周期，例如要发 1，第一个周期发了 1，delay 配成 1，那么第二个周期也会发 1；如果 delay 是 2，那么第三个周期也会发 1
        *   也可以理解成波形的持续时间是寄存器值+1
*   **2025-02-25 星期二**
    *   [[Common_Note#^83f3c5]]

## 本周工作小结

### Sagitta NRE FPGA IODMA 模块验证

*   完成了 WS2812 和 IODMA 的代码迁移和测试环境搭建，并使用新的 fmc 子板进行了测试。
*   验证了 16 线输出功能的正常运行，并解决了 IODMA 传输 0x300 word 数据时中断无法触发的问题。
*   测试了 48MHz 时钟频率下 WS2812 的显示效果，但发现串色现象更为严重。
*   初步分析了 26 号 bit 前面出现乱数据的原因，并尝试通过软件方法（先发 Reset）来规避串色问题。

### Uboot 支持 SPI Nor Flash 驱动

*   了解了启动流程以及 Uboot 的相关知识，包括启用 SPL 的过程。

### Virgo rom、stage1 flash 驱动整理

*   整理了 Virgo 的 rom 和 stage1 flash 驱动，对比了 goxceed 和 robots 平台的差异，并分析了 rom 中 SPI 频率和指令优化方案。

### GT25Q64A SPI 采样点确认

*   确认了 GT25Q64A 在 ECOS 和 SDKV2 平台上的 SPI 采样点均为上升沿。
