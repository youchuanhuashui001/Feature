


# **ğŸ”§ ä»Šæ—¥å·¥ä½œå®‰æ’**
- [[Sagitta NRE FPGA IODMA æ¨¡å—éªŒè¯]]ï¼šæ•´ç†å¥½ä»£ç ï¼Œç°åœ¨åªèƒ½ç”¨ 32MHz çš„æ—¶é’Ÿæµ‹è¯•ï¼Œ48MHz çš„æ—¶é’Ÿåˆ°æ—¶å€™å‡ºäº† bit å¯ä»¥ç›´æ¥åˆ‡è¿‡å»æµ‹è¯•ä¸€æŠŠå°±å¥½äº†


# **ğŸ“Œ å·¥ä½œè¿›å±•**
- Sagitta iodma éªŒè¯ï¼š
	- ws2812ï¼šæ²¡æœ‰å‡º 48MHz çš„ bitï¼ŒæŠŠä»£ç éƒ½è¿åˆ° `drivers/drv-sagitta/test/src` ç›®å½•ä¸‹ï¼Œç”¨æ–°çš„ fmc å­æ¿æµ‹è¯•é€šè¿‡
	- iodmaï¼šæŠŠä»£ç è¿åˆ° `drivers/drv-sagitta/test/src` ç›®å½•ä¸‹ï¼Œç”¨æ–°çš„ fmc å­æ¿æµ‹è¯•
	- æµ‹è¯•ä»£ç éƒ½å‡†å¤‡å¥½äº†
		- æµ‹è¯• iodmaï¼š`driver_test iodma comtest`
			- æ‰“å¼€ Debug ä¿¡æ¯
			- ä¿®æ”¹ `Single_transfer_size = 0x100`
		- æµ‹è¯• ws2812ï¼š`driver_test ws2812 xxx`

---

# **âš ï¸ é—®é¢˜ä¸è§£å†³**
### **é—®é¢˜ 1ï¼š**`cmd/chiptest/chip-sagitta/` ç›®å½•ä¸‹çš„ä¸€å¥—æµ‹è¯•æ¥å£å’Œ `driver/drv-sagitta/test/src/` ä¸‹çš„ä¸€å¥—æµ‹è¯•æ¥å£ï¼Œç†Ÿæ‚‰è¿™ä¸¤å¥—æ¥å£æ˜¯å¹²å˜›çš„ï¼Œiodma å’Œ ws2812 çš„æµ‹è¯•ä»£ç æ”¾åˆ°å“ªé‡Œ
	- iodma å’Œ ws2812 çš„æµ‹è¯•ä»£ç éƒ½æ”¾åˆ° `drivers/drv-sagitta/test/src` ç›®å½•ä¸‹
	- è¿™é‡Œæ˜¯ç”¨äºæµ‹è¯•é©±åŠ¨æ¥å£çš„
```diff
diff --git a/cmd/Kconfig b/cmd/Kconfig
index 9a850959..c19b63b2 100644
--- a/cmd/Kconfig
+++ b/cmd/Kconfig
@@ -89,10 +89,15 @@ config CMD_DRIVER_API_TEST
            Test PADMUX driver functionality including pin multiplexing,
            drive strength, pull up/down control, open drain settings, etc.
          
+         - WS2812 test (gx_ws2812_test)
+           Test WS2812 LED driver functionality including initialization,
+           color control, brightness adjustment, and special effects.
+         
          Usage: driver_test <module> [args]
          Example: driver_test uart help
                  driver_test gpio help
                  driver_test padmux help
+                 driver_test ws2812 help
 
 config CMD_PADMUX_TEST
        bool "padmux test"
@@ -115,6 +120,13 @@ config CMD_RTC_TEST
          The rtc test command is used to verify the functionality of the rtc driver,
          including tick setting and getting, alarm setting, and other features.
 
+config CMD_WS2812_TEST
+       bool "ws2812 test"
+       help
+         This option enables the ws2812 test command.
+         The ws2812 test command is used to verify the functionality of the ws2812 driver,
+         including LED color control, brightness adjustment, special effects, and other features.
+
 source "cmd/flash/Kconfig"

--- a/cmd/driver_api_test.c
+++ b/cmd/driver_api_test.c
@@ -19,6 +19,10 @@
 #include "gx_keyscan_test.h"
 #endif
 
+#if __has_include("gx_ws2812_test.h")
+#include "gx_ws2812_test.h"
+#endif
+
 // å¼±å‡½æ•°å®ç°ï¼Œç”¨äºæœªå®ç°çš„æµ‹è¯•å…¥å£
 __attribute__((weak)) int gx_uart_test_entry(int argc, char **argv)
 {
@@ -44,6 +48,12 @@ __attribute__((weak)) int gx_keyscan_test_entry(int argc, char **argv)
     return -1;
 }
 
+__attribute__((weak)) int gx_ws2812_test_entry(int argc, char **argv)
+{
+    printf("WS2812 test not implemented for this chip\n");
+    return -1;
+}
+
 // å‘½ä»¤å¤„ç†å‡½æ•°
 static int do_driver_test(cmd_tbl_t *cmdtp, int flag, int argc, char * const argv[])
 {
@@ -67,6 +77,10 @@ static int do_driver_test(cmd_tbl_t *cmdtp, int flag, int argc, char * const arg
         gx_keyscan_test_entry(argc - 1, (char **)&argv[1]);
         return 0;
     }
+    else if(strcmp(argv[1], "ws2812") == 0) {
+        gx_ws2812_test_entry(argc - 1, (char **)&argv[1]);
+        return 0;
+    }
     else if(strcmp(argv[1], "help") == 0) {
         return -1;
     }
@@ -83,5 +97,5 @@ U_BOOT_CMD(
     do_driver_test, // å‘½ä»¤å¤„ç†å‡½æ•°
     "Driver API test commands",
     "<module> <command> [args]   - Driver API test functions\n"
-    "Modules: uart, gpio, padmux, keyscan\n"
+    "Modules: uart, gpio, padmux, keyscan, ws2812\n"
 );


--- a/drivers/drv-sagitta/Makefile
+++ b/drivers/drv-sagitta/Makefile
@@ -44,6 +44,7 @@ cobj-y += drivers/drv-sagitta/test/src/gx_padmux_test.o
 cobj-y += drivers/drv-sagitta/test/src/gx_gpio_test.o
 cobj-y += drivers/drv-sagitta/test/src/gx_rtc_test.o
 cobj-y += drivers/drv-sagitta/test/src/gx_keyscan_test.o
+cobj-y += drivers/drv-sagitta/test/src/gx_ws2812_test.o


+drivers/drv-sagitta/test/include/gx_ws2812_test.h
+drivers/drv-sagitta/test/src/gx_ws2812_test.c

```



### **é—®é¢˜ 2ï¼š** iodma ä¼  1 ä¸ª word æ•°æ®æ— æ³•è§¦å‘ä¸­æ–­ï¼Œç”¨ `1-03 bit` å¯ä»¥ï¼Œ`1-17 bit` ä¸è¡Œï¼Œ`2-17 bit` å¯ä»¥

![[Pasted image 20250225151938.png]]

![[Pasted image 20250225151845.png]]

### é—®é¢˜ 3ï¼š2-17 bit iodma ä¼  0x300 ä¸ª word æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ 3 ç»„ dmalite ä¼ è¾“æ•°æ®ï¼Œåªèƒ½ç»„ 0 å®Œæˆï¼Œåé¢çš„ä¸ä¼šè§¦å‘ä¸­æ–­
- 1-03 bit æ­£åœ¨æµ‹è¯•ï¼Œæµ‹ä¸‹æ¥æ²¡é—®é¢˜
- 2-17 bit æœ‰é—®é¢˜ï¼Œä¼  0x300ï¼Œåªèƒ½ç¬¬ 1 ç»„ä¼ è¾“å®Œæˆï¼Œåé¢ä¸¤ç»„çš„ä¸­æ–­ä¸ä¼šä¸Šæ¥ï¼Œä¸€ç›´æ­£åœ¨ä¼ ç¬¬äºŒç»„
![[Pasted image 20250225180548.png]]
- é€»è¾‘åˆ†æä»ªçœ‹æ•°æ®ä¹Ÿæ²¡å‘å®Œï¼Œç¬¬ä¸€ç»„å‘å®Œäº†ï¼Œä½†æ˜¯ç¬¬äºŒç»„å°±æ²¡å‘å®Œ
- èŠ¯ç‰‡è®©ç­‰æ–°çš„ bitï¼Œæœ€è¿‘ iodma å’Œ dmalite æ²¡æœ‰ä¿®æ”¹è¿‡

### é—®é¢˜ 4ï¼šIODMA ä¹‹å‰è¯´æŒ‰èŒƒå›´åˆ· cache çš„æ¥å£æœ‰é—®é¢˜ï¼Œæ˜¯å› ä¸ºç”¨çš„æ˜¯ç‰©ç†åœ°å€ï¼Œå®é™…åº”è¯¥ç”¨è™šæ‹Ÿåœ°å€
- ä¹‹å‰æµ‹è¯•ç”¨ `gx_dcache_clean_range` ä¼ å…¥å‚æ•°ä¸ºç‰©ç†åœ°å€ï¼Œåˆ· cache æœ‰é—®é¢˜ï¼Œä¸€ç›´ç”¨çš„å…¨åˆ·
- æ›´æ¢æˆä¼ å…¥è™šæ‹Ÿåœ°å€ä¹‹åæ²¡é—®é¢˜äº†




---

# **ğŸ’¡ æŠ€æœ¯æ€»ç»“**
[[Common_Note#^83f3c5]] 

---

# **ğŸ“š çŸ¥è¯†å…³è”**


---
# **ğŸ“Œ æ˜æ—¥è®¡åˆ’**
- ç­‰èŠ¯ç‰‡çš„æ–° bit ç€é‡æµ‹è¯•ä¸¤ç‚¹ï¼š
	- iodma ä¸­æ–­ä¸ä¸Šæ¥çš„æƒ…å†µ
	- 48M æ—¶é’Ÿèƒ½å¦é¿å… ws2812 ä¸²è‰²çš„æƒ…å†µ

---

# **ğŸ’¬ æ‰©å±•è®°å½•**



