
## v1.9.8-8.1 分支掉电测试失败


### 软件差异
- 对比 v1.9.8-8.1 分支和 v3.0.1 分支关于写保护的代码是否有差异
	-  从上层到下层
		  - nos：没有差异，只是多了一个参数
			```
			gxloader：flash.c --> gxmisc/nos/sflash.c -->	spinor_base.c      
			```
		    - ecos：没有差异，只是多了一个参数
			```
			ecos: gxmisc/ecos/sflash.c --> spinor_base.c	      
			```




### 实际测试

>[!info]
>Board: VF-19


- dump 之后发现有一个 block 数据全部都是错误的，后面的 block 是好的
	- 这已经是一个问题了
- 查看状态寄存器是不是保持写保护的状态
	- 发现 protect_len 是 0，难道是 boot 工具会 unlock ?
	  - boot 工具并不会 unlock
	    - <span style="color:red">那么写保护的相关寄存器是在什么时候被配成 0 的？</span>
		    - 将 SR1、SR2 都读出来看看
			    - SR1 读出来居然是 0x00，如果是由代码来解除写保护的话会配成 BOTTOM 模式，TOP 模式是0，BOTTOM 模式是 1，所以最起码有 1 bit 会是 1
				- 是的，用自己的板子试过了，如果是自己解写保护会是 SR1 会是 0x20
		    - 用 `v1.9.8-8.1` 分支的代码测试看下
			- 也是一样的，自己解除了写保护会是 0x20 而不是 0x00

			
>[!error] 可以确认是掉电之后 flash 自己将写保护配成了0x00



>[!info]
> Board：VF-6


- 看 Board：VF-6 板子的写保护状态
	- SR1 = 0x10，SR2 = 0x40 还是写保护状态，保护 0x380000
- 跟 flash 厂商沟通



### TODO                                                                                                                                                                                                                                
- [x] 确认下 v1.9.8-8.1 分支和 v3.0.1 分支 GXAPI 的写保护接口是否有差异
	- 没有差异
- [x] 确认下两个分支的 Partition 接口是否有差异
	- 没有差异


### Flash 厂商沟通
- flash 厂商拿到客户的板子之后发现 flash 由于受潮的原因，可能会导致 flash 内部的某些 bit 不稳定，还在查封装相关的问题


### 结果 

- 问题原因：写保护区域在掉电过程中被破坏的现象 flash 厂商分析是由于天地星保留的样片时间过久并且没有真空保存导致 ic 内的某些 bit 不太稳定。这种情况焊接之前需要先 bake，否则焊接后会出现分层的现象。
    - flash 厂商拿到天地星的板子之后加热看到了一些分层
- 解决方案：由于商务的原因，目前这颗产品即使测试过了也做不到天地星要求的那么低的价格，会再给出一款新的 55nm 的产品到天地星再测试(完全兼容目前测试的这颗 65nm 产品) 