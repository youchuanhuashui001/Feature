## 推荐资料：
- 汇编语言资料：`Intel CPU` 相关
- `80x386` 处理器结构和编程相关资料：`INTEL 80386 Programmer's Reference Manual`
- `80x86` 硬件体系结构和接口编程
- `UNIX 操作系统设计` 
- `A.S.Tanenbaum - 操作系统：设计与实现`
- 深度探索嵌入式操作系统 





## 文件系统 (fs) P625

>  高速缓冲区的工作原理和实现方式介绍，可先浏览 `M.J.Bach` 先生著的 `《UNIX 操作系统设计》- 第 3 章 数据缓冲区高速缓冲` 

### 数据缓冲区高速缓冲 (Buffer cache)
-  [[Draw_Note]] 
![[Pasted image 20241211200105.png]]

#### 导学 
1. `buffer` 就是 `unix 系统设计` 中描述的，用内存当 `buffer`
2. 需要关心后面 `3` 点 

### 总体描述 
1. `buffer`: 有关高速缓冲区的管理程序，主要实现了对磁盘等块设备进行数据高速存取的函数
2. 文件系统的低层通用函数：说明了对于 `inode` 的管理、磁盘数据块的分配和释放以及文件名与 `inode` 的转换算法
3. 对文件中数据进行读写操作，包括对字符设备、管道、块读写文件中数据的访问
4. 文件的系统调用接口的实现，主要涉及文件打开、关闭、创建以及有关文件目录等操作等的系统调用 

#### MINUX 文件系统

> [!Tips]
> `MINIX` 文件系统是 `UNIX` 文件系统的一种简化版本，用于教学和学习目的，其实和 `FAT32、NTFS` 这种文件系统一样，都是文件系统

MINIX 文件系统由 6 个主要部分组成：

1. 引导块(Boot Block)：
   - 位于文件系统的第一个块
   - 包含引导代码和分区表

2. 超级块(Super Block)：`include/linux/fs.h/ struct super_block`
   - 包含文件系统的关键参数
   - 记录文件系统的大小、未使用的块数等信息
3. i节点位图(Inode Bitmap)：
   - 用于跟踪i节点的使用情况
   - 每个位表示一个i节点是否被占用
   - <font color=green>注意：这里是一个 bit map</font>
4. 逻辑块位图(Zone Bitmap)：
   - 记录数据块的使用状态
   - 管理文件系统中可用空间
5. i 节点区 `(Inode Area)` ：一个节点对应一个文件 
   - 存储所有文件的i节点信息
   - 包含文件的元数据（大小、权限、时间戳等）
	 -  存在两个 `i node` ，一个是 `d_inode` 、一个是 `m_inode` 
		  - `d_inode`  用于存放在磁盘，信息较少 
		 -  `m_inode`  用于存放在内存，和 ` d_inode ` 基本一致，有更多的信息
6. 数据块区(Data Zone)：实际用来存数据的 
   - 存储文件的实际内容
   - 占据文件系统的大部分空间


#### 文件类型、属性和目录项

- `UNIX` 类操作系统中的文件通常可分为 6 类：
	- 正规文件：普通文件。可包含任意长度的字节流。例如源程序文件、二进制执行文件、文档以及脚本
	- 目录名：`'d'` 在 `UNIX` 类操作系统中也是以一种文件形式呈现出来，但文件系统管理会对其内容进行解释，以使人们可以看到有哪些文件包含在一个目录中，以及它们是如何组织在一起构成一个分层次的文件系统的 
	- 符号链接文件：`s` 用于使用一个不同文件名来引用另一个文件 
	- 命名管道文件
	- 字符设备文件
	- 块设备文件 

![[Pasted image 20241212190800.png]]
![[Pasted image 20241212190850.png]]
![[Pasted image 20241212190952.png]]

![[Pasted image 20241212191358.png]]



#### 高速缓冲区

高速缓冲区是文件系统访问块设备中数据的必经要道。为了访问块设备上文件系统中的数据，内核可以每次都访问块设备，进行读或写操作。但是每次 I/O 操作的时间与内存和 CPU 的处理速度相比是非常慢的。为了提高系统的性能，内核就在内存中开辟了一个高速数据缓冲区 `buffer cache`，并将其划分成一个个与磁盘数据块大小相等的缓冲块来使用和管理，以期减少访问块设备的次数。