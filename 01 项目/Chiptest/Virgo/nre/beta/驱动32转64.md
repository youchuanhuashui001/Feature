
# 不同数据类型在不同位宽机器下所占字节数

| 类型                 | 16位操作系统(byte) | 32位操作系统(byte) | 64位操作系统(byte) | 取值范围                                         |
| :----------------- | :------------ | :------------ | :------------ | :------------------------------------------- |
| char               | 1             | 1             | 1             | -128-127                                     |
| unsigned char      | 1             | 1             | 1             | 0-255                                        |
| short              | 2             | 2             | 2             | -32768-32767                                 |
| unsigned short     | 2             | 2             | 2             | 0-65535                                      |
| int                | 2             | 4             | 4             | -2147483648-2147483647                       |
| unsigned int       | 2             | 4             | 4             | 0-4294967295                                 |
| long               | 4             | 4             | 4             | -2147483648-2147483647                       |
| unsigned long      | 4             | 4             | 4             | 0-4294967295                                 |
| long long          | 8             | 8             | 8             | -9223372036854775808<br>-9223372035054775807 |
| unsigned long long | 8             | 8             | 8             | 9223372036854775808                          |
| double             | 8             | 8             | 8             | 1.7E+308的次方-1.7E+308次方                       |
| float              | 4             | 4             | 4             | 3.4E+38的份38次方-3.4E+38的38次方                   |
| long double        | 10/12         | 10/10         | 10/16         |                                              |
| 指针                 | 2             | 4             | 8             | -                                            |



# `unsigned int` 强转成 `(unsigned char *)` 报警告

```c
inline int gxflash_readdata(unsigned int addr, unsigned char *data, unsigned int len)

{

if(flash_ops->readdata != NULL)

return flash_ops->readdata(addr, data, len);

else

return -1;

}

  

  
bootmenu.c:1683:37: 警告： 将一个整数转换为大小不同的指针 [-Wint-to-pointer-cast]

1683 | gxflash_readdata(flashaddr, (unsigned char *)ramaddr, len);

  


void flash_read(int argc, const char **argv)

{

unsigned int ramaddr, flashaddr, len;

uint32_t j = 0;

  

if (argc < 5) {

printf(FLASHW_MSG);

return;

}

  

flashaddr = atoi(argv[2]);

ramaddr = atoi(argv[3]);

len = atoi(argv[4]);

  

gxflash_readdata(flashaddr, (unsigned char *)ramaddr, len);

for (j = 0; j < len; j++) {

printf("%02x ", ((unsigned char *)ramaddr)[j]);

if((j+1)%16 == 0)

printf("\n");

}

  

printf("\n");

}
```

- 在 arm32 中 unsigned int 是 4 字节，unsigned char * 也是 4 字节
- 在 arm64 中 unsigned int 是 4 字节，unsigned char * 是一个指针，是 8 字节
- `uintptr_t` 是 `unsigned long` 类型，在 32 位机器上为 4 字节，64 位机器上是 8 字节
- **对于想用整数作为内存地址的情况，使用 `uintptr_t` 兼容 32/64 位机器**


# 默认没有编译 spi 相关驱动
- 需要在 `.config` 中打开 `ENABLE_SPIFLASH = y`





# `unsigned char *` 强转成 ` unsigned int ` 报警告
```c
case GX_FLASH_CHIP_NAME:
	return (unsigned int)flash->info->name;
```
- name 是字符串，强转成 `unsigned int` 之后保存的是这个字符串所在的内存地址，然后在使用的时候再强转回 `unsigned char *` 即可解析出原有的字符串
- 64 位系统上，因为指针使用 `8` 字节表示的，如果用 `unsigned int` 只会保留 4 字节的内存地址，保存的是错的内存地址，再强转回去就找不到原有的内存地址所在的字符串。
- 接口修改成使用 `uintptr_t` 来表示，在 32 位系统时是 4 字节，在 64 位系统时是 8 字节



# gxmisc 编译流程
```
build 
	make spinor_gxloader_arm64_defconfig
	make lib
		make dir -p output
		./scripts/config_parse.sh
			将 .config 中的内容解析生成 autogenerated_config.h 文件
			这个里面其实什么东西都没有
		./scripts/auto.sh
			将 .config 中的内容解析生成 autoconf.h 文件
		$(LIB_PACK)
			lib_spinor_arm64.a
				把所有的.c .S 编译成 .o 然后打包成.a
				ar arflags $@ $(sobj-y) $(cobj-y)
					sobj-y:
						$(CC) $(ASFLAGS) -c $< -o $@
					cobj-y:
						$(CC) $(CCFLAGS) -c $< -o $@
	make install
		install -d output/lib
		install -d output/include
		# install -d 创建带权限的目录
		拷贝所有的库，头文件文件到对应的位置
```

```c
gxloader
	flash.c
	flash/spinor/sflash.c
	spi/dw_spi/dw_spi_v2.c
	spi/spi.c
	platform/device.c
```