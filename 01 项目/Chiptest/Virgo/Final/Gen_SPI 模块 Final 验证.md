
## 背景知识 

- 需要配置引脚复用
	- `spi0_mst_sclk_in` 引脚在 `fpga` 阶段用不到，等到时芯片回来再测试 





## 测试过程


### 程序卡死在等待 `txfifo_empty`
- 程序卡死在等待 `txfifo_empty`，但是查看 `0x28` 寄存器发现已经 `empty`
- 发现是程序中配置的基地址是 `Gen_SPI1`，但是芯片编的是 `Gen_SPI0`
	- 修改程序中的基地址后正常 



### 作为 Master 发了，但是 Slave 没响应

- 逻辑分析仪抓到 `cs、wp、hold` 引脚都是低电平，需要硬件把板子改一下，加上弱上拉 
	- 这里再斟酌一下，因为对接 spi 的时候 wp、hold 低电平也没关系 
		- 将 wp、hold 两个脚不复用，单线的时候波形是怎么样的? 
			 - 单线的时候 `cs、mosi、miso` 几个脚都一直是低电平，单独配置 `0xfc001080` 拉高拉低 `cs` 脚都没作用，`cs` 脚一直都是低电平 
 - 更换一块子板，需要保证 `gpio` 的拨码开关都是好的
 - 拨码开关需要动态的拨，`tx`  的时候拨成 ` output `，` rx ` 的时候拨成 ` input ` 


### 动态拨码，做 Slave 时收不到数据

- 是由于做 slave 的时候 `apus` 那边的引脚复用有问题

- 做 slave 的时候，`cs、clk` 都是作为 `input` 脚接收来自 `master` 的输入；`mosi、miso` 脚要动态的根据 `tx/rx` 调整 







## 测试结果 
- `Master` 模式对接 ` Apus Gen SPI ` 测通
- `Slave` 模式对接 `Apus Gen SPI` 测通



> [!tips]
>  - 测试 `gpio` 的引脚电平转换都是单向的，所以需要通过拨码开关来切换
>  - 测试 `flash` 的引脚电平转换都是双向的，所以可以直接动态切输入输出 



