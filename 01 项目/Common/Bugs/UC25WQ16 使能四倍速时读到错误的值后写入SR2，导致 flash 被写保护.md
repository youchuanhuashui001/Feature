
[[Leo_mini 支持 UC25WQ16]]

## 问题现象：
- AI 这边要支持 UC25WQ16，读写擦测试后进行掉电测试，但掉电测试程序是新增的
- 掉电测试没问题，拿过来之后发现烧不进去程序
- 抓波形发现擦除后读状态，一次就拿到了 ok 的状态


## 问题原因：
- 考虑到 read 操作可以正常进行，擦除操作进行不了，可能是写保护了
- 写保护分为硬件写保护和软件写保护
	- 硬件写保护：逻辑分析仪抓波形时 WP 脚是正常的，空闲时间为高电平
	- 软件写保护：驱动中没有支持这款 flash 的软件写保护，状态寄存器读出`SR1=0x0,SR2=0x62`，对应的 `CMP = 1, BPx = 0` 导致整个 flash 被写保护
![[Pasted image 20241126091756.png]]
- 添加驱动解除写保护，解除写保护后能够正常操作 flash
- 因此，**问题原因可能是在使能四线模式时，先从 SR2 寄存器中读出的时候由于 `Sample delay` 不匹配的原因导致读错了，然后配置 `QE` 位的时候把错误的数据写到了 `SR2`**

## 解决方法：
- 分析 Stage1 的频率和相位，是否存在边缘值的情况
- 分析 Stage2 的频率和相位，是否存在边缘值的情况